<!DOCTYPE html>
<html lang="es">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, shrink-to-fit=no">
        <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css">
        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css">
        <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.0.12/css/all.css">
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
        <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js"></script>
        <link rel="stylesheet" href="../../css/styles.css" type="text/css"/>
        <title>Administración</title>
    </head>
    <body style="padding-top: 60px;" class="bg-dark">
        <nav class="navbar navbar-dark bg-light navbar-expand-sm fixed-top">
            <div class="container-fluid">
                <img alt="logo" width="40" height="40" src="../../images/tastyigniter-logo.png">
                <div style="font-size: 30px;">Administrator Panel </div>
                <div class="collapse navbar-collapse"></div>
            </div>
        </nav>
        <div class="container-fluid bg-secondary">
            <div class="row display-4" style="font-size: 30px; height: 560px;">
                <div class="col-2 py-5 pl-4" style="background-color: rgb(5, 5, 54);">
                    <div>
                        <ul id="menu-dashboard" class="navbar-nav pl-3 text-left">
                            <li class="py-3">
                                <a class="text-light" data-toggle="collapse" data-target="#submenu1"
                                aria-expanded="false">
                                >Cocina
                                <ul class="navbar-nav pl-3 text-left collapse h5" id="submenu1">
                                    <li><div class="text-light" id="menudishes">Platillos</div></li>
                                    <li><div class="text-light" id="menucategories">Categorias</div></li>
                                </ul>
                            </li>
                            <li class="py-3">
                                <a class="text-light" data-toggle="collapse" data-target="#submenu2">
                                    >Ventas
                                </a>
                                <ul class="navbar-nav pl-3 text-left collapse h5" id="submenu2">
                                    <li><div class="text-light" >Ordenes</div></li>
                                </ul>
                            </li>
                            <li class="py-3">
                                <a class="text-light" data-toggle="collapse" data-target="#submenu3">
                                    >Usuarios
                                </a>
                                <ul class="navbar-nav pl-3 text-left collapse h5" id="submenu3">
                                    
                                </ul>
                            </li>
                        </ul>
                    </div>
                </div>
                
                <div class="col-10 pt-4 display-3" >
                    <div class="container" id="panel">

                    </div>
                </div>
            </div>
        </div>
        <!-- Footer -->
        <footer class="page-footer font-small mt-5">
            <div class="footer-copyright text-center text-white bg-dark py-3">
                © 2020 Copyright.<br>
                <h6 class="text-center">Universidad Nacional De Costa Rica</h6>
            </div>
        </footer>
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js"></script>
        <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js"></script>
        <script>
            function loaded(){
              $("#menudishes").click(loadDishes);  
              $("#menucategories").click(loadCategories);  
            }

            $(loaded);
              
            function errorMessage(status, place) {
                error = status;
                switch (status) {
                    case 401:
                        error = "Usuario no registrado";
                        break;
                    case 403:
                    case 405:
                        error = "Usuario no autorizado";
                        break;
                    case 404:
                        error = "Registro no encontrado";
                        break;
                }
                ;
                place.html('<div class="alert alert-danger fade show">' +
                        '<button type="button" class="close" data-dismiss="alert">' +
                        '&times;</button><h4 class="alert-heading">Error!</h4>' + error + '</div>');
                return;
            }
            //-----------------------------SCRIPTS FUNCTION DISHES----------------------------------//
            function loadDishes() {
                $.ajax({
                    type: "GET",
                    url: "/Food_Service_PIV/web/api/dishes",
                    contentType: "application/json"
                }).then(
                        (dishes) => {
                    showDishes(dishes);
                },
                        (error) => {
                    errorMessage(error.status, $("#dishes"));
                }
                );
            }
            
            function showDishes(dishes){
                var list = $("#panel");
                list.html("");
                list.html('<div class="container-fluid rounded text-white" style="background-color: rgb(5, 5, 54);">' +
                    '<div class="row py-1  align-items-center justify-content-center">'+
                        '<div class="col-6 text-center " style="font-size: 60px;"> Menu </div>'+
                        '<div class="col-2 center-block">'+
                            '<button type="button" class="btn btn-primary btn-lg btn-block bg-light text-dark">Agregar</button>' +
                        '</div>'+
                    '</div>'+
                '</div>'+
                '<div class="card bg-light">'+
                    '<div class="card-body text-center">'+
                        '<div class="table-responsive " overflow: auto">'+
                            '<table class="table table-striped table-hover" style="font-size: 22px;">'+
                                '<thead><tr><th scope="col">Categoria</th>'+
                                '<th scope="col">Nombre</th><th scope="col">Precio</th>'+
                                '<th colspan="2" scope="col"></th> '+
                                '<tbody id="listado">'+
                                '</tbody>'+
                            '</table>'+
                        '</div>'+         
                    '</div>'+
                '</div>');
                var anchor = $('#listado');
                dishes.forEach((c) => {
                    rowDish(anchor, c);
                });
            }

            function rowDish(anchor, c) {
                var tr =$("<tr />");
                tr.html('<td>' + c.categories.name + '</td>' +
                        '<td>' + c.name + '</td>' +
                        '<td>' + c.price + '</td>' +
                        '<td><button type="button" class="btn btn-primary btn-lg btn-block" data-toggle="modal" data-target="#editDialog" onclick="searchDish('+ c.id +')">Ver / Editar</button>' +
                        '</td>' +
                        '<td>' +
                        '<button type="button" class="btn btn-primary btn-lg btn-block" onclick="deleteDish('+ c.id +')">Eliminar</button>' +
                        '</td>' +  
                        '</tr>');
                anchor.append(tr);
            }
            
            function searchDish(id){
                $.ajax({
                    type: "GET",
                    url: "/Food_Service_PIV/web/api/dishes/" + id,
                    contentType: "application/json"
                }).then(
                    (dish) => { editDish(dish);
                    },(error) => {
                        errorMessage(error.status, $("#dishes"));
                    }
                );
            }
            
            function editDish(dish){
                var anchor = $('#listado');
                var html = '<div class="row">'+
                        '<div class="modal fade" id="editDialog" tabindex="-1" role="dialog" >'+
                            '<div class="modal-dialog" role="document">'+
                            '<div class="modal-content">'+
                                '<form>'+
                                    '<div class="modal-body text-center">'+
                                        '<div id="div-login-msg">'+
                                            '<div id="icon-login-msg" ></div>'+
                                            '<span class="h1">' + dish.categories.name + '<br>' + dish.name + '</span>'+
                                        '</div>'+
                                        '<br>'+
                                        '<div class = "input-group" style = "margin-bottom: 25px">'+
                                            '<div class = "input-group-prepend "><span class = "input-group-text"><i>Nombre</i></span></div>'+
                                                '<input class = "form-control" placeholder = "Nombre" type = "text" id = "name" name="name" value="'+dish.name+'" required>'+
                                            '<div class = "invalid-feedback">Favor ingrese el nombre del platillo</div>'+
                                        '</div>'+
                                        '<div class = "input-group" style = "margin-bottom: 25px">'+
                                            '<div class = "input-group-prepend "><span class = "input-group-text"><i>Precio</i></span></div>'+
                                                '<input class = "form-control" placeholder = "Precio" type = "text" id = "price" name="price" value="'+dish.price+'" required>'+
                                            '<div class = "invalid-feedback">Favor ingrese el precio del platillo</div>'+
                                        '</div>'+
                                        '<div class = "input-group" style = "margin-bottom: 25px">'+
                                            '<div class = "input-group-prepend "><span class = "input-group-text"><i>Descripción</i></span></div>'+
                                                '<input class = "form-control" placeholder = "Descripción" type = "text" id = "decription" name="decription" value="'+dish.decription+'" required>'+
                                            '<div class = "invalid-feedback">Favor ingrese el precio del platillo</div>'+
                                        '</div>'+
                                        
                                    '</div>'+
                                    '<div class="modal-footer d-flex justify-content-center">'+
                                        '<div>'+
                                            '<button type="button" id="updateButton" data-dismiss="modal" class="btn btn-primary btn-lg btn-block" onclick="updateDish(' + dish.id + ')">Actualizar</button>'+
                                            ' <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>'+
                                        '</div>'+
                                    '</div>'+
                                    '<div id="loginErrorDiv" style="width:80%; margin: auto;"></div> '+    
                                '</form>'+
                            '</div>'+
                        '</div>'+
                    '</div>'+
                '</div> '
                anchor.append(html);
            }
            
            function deleteDish(id){
                $.ajax({
                    type: "DELETE",
                    url: "/Food_Service_PIV/web/api/dishes/" + id,
                    contentType: "application/json"
                }).then(
                        (dishes) => {
                    showDishes(dishes);
                },
                        (error) => {
                    errorMessage(error.status, $("#dishes"));
                }
                );
            }
            
            function updateDish(idDish){ 
              dish = {id:idDish, 
                name: $("#name").val(),      
                price: $("#price").val(),
                decription: $("#decription").val()};
              $.ajax({type: "PUT", url:"/Food_Service_PIV/web/api/dishes",
                          data: JSON.stringify(dish),contentType: "application/json"})
                .then( (dishes)=>{$('#editDialog').modal('hide'); showDishes(dishes); },
                       (error)=>{errorMessage(error.status,$("#addErrorDiv"));});                          
            }
            
            //-----------------------------SCRIPTS FUNCTION CATEGORIES------------------------------//
            
            function loadCategories() {
                $.ajax({
                    type: "GET",
                    url: "/Food_Service_PIV/web/api/categories",
                    contentType: "application/json"
                }).then(
                        (categories) => {
                    showCategories(categories);
                },
                        (error) => {
                    errorMessage(error.status, $("#categories"));
                }
                );
            }
            
            function showCategories(categories){
                var list = $("#panel");
                list.html("");
                list.html('<div class="container-fluid rounded text-white" style="background-color: rgb(5, 5, 54);">' +
                    '<div class="row py-1  align-items-center justify-content-center">'+
                        '<div class="col-6 text-center " style="font-size: 60px;"> Categorias </div>'+
                        '<div class="col-2 center-block">'+
                            '<button type="button" class="btn btn-primary btn-lg btn-block bg-light text-dark">Agregar</button>' +
                        '</div>'+
                    '</div>'+
                '</div>'+
                '<div class="card bg-light">'+
                    '<div class="card-body text-center">'+
                        '<div class="table-responsive " overflow: auto">'+
                            '<table class="table table-striped table-hover" style="font-size: 22px;">'+
                                '<thead><tr>'+
                                '<th scope="col">Id</th><th scope="col">Nombre</th><th scope="col"></th>'+
                                '<tbody id="listado">'+
                                '</tbody>'+
                            '</table>'+
                        '</div>'+         
                    '</div>'+
                '</div>');
                var anchor = $('#listado');
                categories.forEach((c) => {
                    rowCategorie(anchor, c);
                });
            }

            function rowCategorie(anchor, c) {
                var tr =$("<tr />");
                tr.html('<td>' + c.id + '</td>' +
                        '<td>' + c.name + '</td>' +
                        '<td><button type="button" class="btn btn-primary btn-lg btn-block" data-toggle="modal" data-target="#editDialog" onclick="searchCategorie('+ c.id +')">Ver / Editar</button>' +
                        '</td>' +
                        '</tr>');
                anchor.append(tr);
            }
            
            function searchCategorie(id){
                $.ajax({
                    type: "GET",
                    url: "/Food_Service_PIV/web/api/categories/" + id,
                    contentType: "application/json"
                }).then(
                    (categorie) => { editCategorie(categorie);
                    },(error) => {
                        errorMessage(error.status, $("#categories"));
                    }
                );
            }
            
            function editCategorie(categorie){
                var anchor = $('#listado');
                var html = '<div class="row">'+
                        '<div class="modal fade" id="editDialog" tabindex="-1" role="dialog" >'+
                            '<div class="modal-dialog" role="document">'+
                            '<div class="modal-content">'+
                                '<form>'+
                                    '<div class="modal-body text-center">'+
                                        '<div id="div-login-msg">'+
                                            '<div id="icon-login-msg" ></div>'+
                                            '<span class="h1">' + categorie.name + '</span>'+
                                        '</div>'+
                                        '<br>'+
                                        '<div class = "input-group" style = "margin-bottom: 25px">'+
                                            '<div class = "input-group-prepend "><span class = "input-group-text"><i>Nombre</i></span></div>'+
                                                '<input class = "form-control" placeholder = "Nombre" type = "text" id = "name" name="name" value="'+ categorie.name +'" required>'+
                                            '<div class = "invalid-feedback">Favor ingrese el nombre de la categoria</div>'+
                                        '</div>'+
                                    '</div>'+
                                    '<div class="modal-footer d-flex justify-content-center">'+
                                        '<div>'+
                                            '<button type="button" id="updateButton" data-dismiss="modal" class="btn btn-primary btn-lg btn-block" onclick="updateCategorie(' + categorie.id + ')">Actualizar</button>'+
                                            ' <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>'+
                                        '</div>'+
                                    '</div>'+
                                    '<div id="loginErrorDiv" style="width:80%; margin: auto;"></div> '+    
                                '</form>'+
                            '</div>'+
                        '</div>'+
                    '</div>'+
                '</div> '
                anchor.append(html);
            }
            
            function updateCategorie(idCategorie){ 
              categorie = { id:idCategorie, 
                            name: $("#name").val() }
              $.ajax({type: "PUT", url:"/Food_Service_PIV/web/api/categories",
                          data: JSON.stringify(categorie),contentType: "application/json"})
                .then( (categories)=>{$('#editDialog').modal('hide'); showCategories(categories); },
                       (error)=>{errorMessage(error.status,$("#addErrorDiv"));});                          
            }
        </script>
    </body>

</html>