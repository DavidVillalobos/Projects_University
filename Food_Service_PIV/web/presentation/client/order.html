<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, shrink-to-fit=no">
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css">
    <title>Pedido</title>
</head>
<body style="padding-top: 85px; background-color: #D5D5E0;">
    <nav class="navbar navbar-dark bg-dark navbar-expand-sm fixed-top">
	<div class="container">
            <a class="navbar-brand" href="#">
		<img alt="logo" width="40" height="40" src="https://demo.tastyigniter.com/assets/media/uploads/tastyigniter-logo.png">
            </a>
            <div class="collapse navbar-collapse">
		<ul class="navbar-nav ml-auto">
                    <li class="nav-item">
			<a href="#" class="nav-link">View Menu</a>
                    </li>
                    <li class="nav-item">
			<a href="#" class="nav-link">Login</a>
                    </li>
                    <li class="nav-item">
			<a href="#" class="nav-link">Register</a>
                    </li>
		</ul>
            </div>
	</div>
    </nav>
    <div class="container">
        <div class="row">
            <div class="col-2">
		<h5 class="px-3">Categories</h5>
		<div id="categories"></div>
            </div>
            <div class="col-6">
		<div class="container">
                    <div class="container-fluid bg-white mb-1 rounded">
			<div class="dropdown py-3">
                            <button class="btn border-primary btn-light btn-block rounded dropdown-toggle text-truncate" 
                            type="button" id="OrderTimePicker" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
				<b>ASAP</b>
                            </button>
                            <div class="dropdown-menu" aria-labelledby="OrderTimePicker">
                                <button class="dropdown-item py-2">ASAP</button>
                                <div class="dropdown-divider"></div>
				<button class="dropdown-item py-2">Schedule Order</button>
                            </div>
			</div>
                    </div>
                    <div class="container-fluid bg-white mb-1 rounded">
			<div class="row py-3">
                            <div class="col-6">
				<h3 class="font-italic">Food Service</h3>
                                <div class="text-muted">345 Lewisham Road, London SE13 7AB, United Kingdom</div>
                            </div>
                            <div class="col-6">
                                <span class="text-success">We are open</span>
                                <div>24 hours, 7 days.</div>
                                <div class="text-muted">Delivery and pick-up available </div> 
                            </div>
			</div>
                    </div>
                    <div class="container-fluid bg-white rounded">
			<h6 class="text-primary px-1 py-3">Menu</h6>
                    </div>
                    <div id="selected-categories" class="container-fluid bg-white rounded">
                        <div id="new-seccion"></div>
                        <div class="modal fade" id="detail_popup" tabindex="-1" role="dialog" 
                        aria-labelledby="detail_popup_title" aria-hidden="true">
                            <div class="modal-dialog" role="document">
                                <div class="modal-content">
                                    <div class="modal-header">
                                        <h5 class="modal-title" id="detail_popup_title"></h5>
                                        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                            <span aria-hidden="true">&times;</span>
                                        </button>
                                    </div>
                                    <div id="detail_popup_body" class="modal-body">
                                        ...
                                    </div>
                                    <div id="detail_popup_footer" class="modal-footer">
                                        <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                                        <button type="button" class="btn btn-primary">Save changes</button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
		</div>
            </div>
            <div class="col-4">
		<div class="container-fluid bg-white rounded mb-1">
                    <div class="container py-2">
			<!-- BOTONES DE DELIVERY Y PICKUP -->
			<div class="btn-block btn-group btn-group-toggle" data-toggle="buttons">
                            <label class="btn btn-outline-primary active">
                                <input type="radio" name="options" id="option1" autocomplete="off" checked>
    				<b>Delivery</b>
                            </label>
                            <label class="btn btn-outline-primary">
    				<input type="radio" name="options" id="option2" autocomplete="off">
    				<b>Pickup</b>
                            </label>
			</div>
                    </div>
                    <br>
                    <div class="container-fluid pb-1">	
			<div class="row">
                            <div class="col-2">
				<button type="button" class="btn btn-outline-primary" style="padding: 0px 5px;">
                                    <b>-</b>
				</button>
                            </div>
                            <div class="col-7">
				<small class="text-uppercase">Nombre del Platillo</small>
                            </div>
                            <div class="col-3">
				c10.00000
                            </div>
			</div>
			<div class="row">
                            <div class="col-2"></div>
                            <div class="col-10">
				<small class="text-muted">
                                    <div>texto que tenga</div>
                                    <div>que ver con el </div>
                                    <div>platillo jejeps </div>
                                    <div>no tengo idea de que poner.</div>
				</small>
                            </div>
			</div>	
                    </div>
		</div>
		<div class="container-fluid bg-white rounded mb-1 pb-2">
                    <div class="row py-2">
			<div class="col-4">
                            <div class="text-muted">Sub-Total:</div>
                            <div class="text-muted">Delivery:</div>
                            <div class="text-muted">Order-Total:</div>
			</div>	
                        <div class="col-8 text-right">
                            <div>c13023.324</div>
                            <div>c0</div>
                            <div>c13023.324</div>
			</div>	
                    </div>
                    <button class="btn btn-danger btn-block">Checkout</button>
		</div>
            </div>
	</div>
    </div>
    <!-- Footer -->
    <footer class="page-footer font-small mt-5">
	<div class="container-fluid bg-primary text-dark">
            <div class="row py-4">
		<div class="col-6">
                    <h5 class="text-right">FOOD SERVICE BY:</h5>
                </div>
		<div class="col-6">
                    <div class="h5 text-left">Kevin A. Flores</div>
                    <div class="h5 text-left">Luis D. Villalobos</div>
		</div>
            </div>
	</div>
    	<div class="footer-copyright text-center text-white bg-dark py-3">
            Â© 2020 Copyright.<br><h6 class="text-center">Universidad Nacional De Costa Rica</h6>
 	 </div>
    </footer>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js"></script>
    <script>
        function init(){
            loadCategories();
        }
        
        $(init);
        
        function loadCategories(){
            $.ajax({
                type:"GET",
                url:"/Food_Service_PIV/web/api/orders/categories",
                contentType:"application/json" 
            }).then(
                (categories)=>{showCategories(categories);},
                (error)=>{errorMessage(error.status,$("#categories"));}
            );
        }
        
        function showCategories(categories){
            var list=$("#categories");
            list.html("");
            categories.forEach((c)=>{addCategorie(list,c);});
        }
        
        function addCategorie(list,c){
            var anchor=$('<a id="'+c.id+'" class="nav-link" href="#"></a>');
            anchor.html(c.name);
            //tr.find("#edit").on("click",()=>{edit(persona.cedula);});
            anchor.on("click",()=>{verifySelectedCategorie(c.id);});
            list.append(anchor);
        }
        
        function verifySelectedCategorie(id){
            if($("#"+id).hasClass("text-danger")){
                $("#"+id).removeClass("text-danger");
                $("#div-"+id).remove();
            }
            else{
                $("#"+id).addClass("text-danger");
                loadDishes(id);
            }
        }
        
        function loadDishes(id){
            $.ajax({
                type:"GET",
                url:"/Food_Service_PIV/web/api/orders?categorie="+id,
                contentType:"application/json"
            }).then(
                (dishes)=>{showDishes(dishes);},
                (error)=>{errorMessage(error.status,$("#categories"));}
            );
        }
       
        function hasAdditionals(idDish,mainDiv){
            $.ajax({
                type:"GET",
                url:"/Food_Service_PIV/web/api/orders/hasAdditionals/"+idDish,
                contentType:"application/json"
            }).then(
                (additionals)=>{
                    if(additionals.length>0){
                        mainDiv.find("#add_button").attr("data-target","#detail_popup");
                    };
                },
                (error)=>{errorMessage(error.status,$("#selected-categories"));}            
            );
            return mainDiv.find("#add_button").attr("data-target")==="#detail_popup";
        }
        
        function showDishes(dishes){
            if(dishes.length > 0){
                var mainDiv=$("#new-seccion");
                mainDiv.attr("id","div-"+dishes[0].categories.id);
                mainDiv.addClass("py-1");
                //var mainDiv=$('<div class="py-1" id="div-'+dishes[0].categories.id+'"></div>');
                var mainButton=$('<button class="btn btn-block btn-outline-dark" type="button" data-toggle="collapse"'+ 
                                 'data-target="#seccion-'+dishes[0].categories.id+'" aria-expanded="false">');
                mainButton.html("<h5>"+dishes[0].categories.name+"</h5>");
                mainDiv.append(mainButton);
                dishes.forEach((d)=>{
                    var newDish=$(
                    '<div id="seccion-'+d.categories.id+'" class="collapse">'+
			'<div class="row pt-2 pl-2">'+
                            '<div class="col-8">'+
				'<h6 class="text-uppercase">'+d.name+'</h6>'+
                                '<div><small class="text-muted text-justify">'+
                                    d.decription+
                                '</small></div>'+	
                            '</div>'+
                            '<div class="col-3 font-weight-bold text-right">'+
                                d.price+
                            '</div>'+
                            '<div class="col-1">'+
                                '<button id="add_button" type="button" class="btn btn-outline-primary"'+
                                ' data-toggle="modal" data-target="#DoNotHave"  style="float:right; padding: 0px 5px;">'+
                                    '<b>+</b>'+
                                '</button>'+
                            '</div>'+
			'</div>'+
                    '</div>'    
                    );
                    mainDiv.append(newDish);
                    var x = hasAdditionals(d.id,mainDiv);
                    //mainDiv.find("#add_button").on("click",()=>{validateDish(d,x);});
                });
                var selected=$("#selected-categories");
                selected.append(mainDiv);
                selected.append($('<div id="new-seccion"></div>'));
            }
        }
        
        function validateDish(dish,x){
            if(x){
                $.ajax({
                    type:"GET",
                    url:"/Food_Service_PIV/web/api/orders/details/"+dish.id,
                    contentType:"application/json"
                }).then(
                   (details)=>{updateDetailPopup(details);},
                   (error)=>{errorMessage(error.status,("#detail_popup"));}
                );
            }
        }
        
        function errorMessage(status,place){
            error=status;
            switch(status){
                case 401: error= "Usuario no registrado"; break;
                case 403: case 405: error="Usuario no autorizado"; break;                
                case 404: error= "Registro no encontrado"; break;
            };            
            place.html('<div class="alert alert-danger fade show">' +
            '<button type="button" class="close" data-dismiss="alert">' +
            '&times;</button><h4 class="alert-heading">Error!</h4>'+error+'</div>');
            return;        
        }
        
    </script>
</body>
</html>
